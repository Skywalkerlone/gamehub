<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search Xavier | Xavier Games Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            background: linear-gradient(135deg, #0c1a2d 0%, #1a3a5f 100%);
            color: #fff;
            min-height: 100vh;
            padding: 15px;
            touch-action: manipulation;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            height: 100vh;
            max-height: 100vh;
        }
        
        .header {
            text-align: center;
            width: 100%;
            padding: 10px;
            flex-shrink: 0;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(255, 126, 95, 0.5);
        }
        
        .header p {
            font-size: 1rem;
            color: #a3c4f3;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(15, 37, 71, 0.9);
            color: white;
            border: 2px solid #2a4a7a;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            z-index: 100;
        }
        
        .back-btn:active {
            transform: scale(0.95);
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: rgba(15, 37, 71, 0.9);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #2a4a7a;
            flex-shrink: 0;
        }
        
        .info-box {
            text-align: center;
            flex: 1;
        }
        
        .info-box h3 {
            font-size: 0.9rem;
            color: #a3c4f3;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        .info-value.time-warning {
            color: #ff5252;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .difficulty-btn {
            background: rgba(42, 74, 122, 0.7);
            color: white;
            border: 2px solid #2a4a7a;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .difficulty-btn.active {
            background: #ff7e5f;
            color: #0c1a2d;
            border-color: #ff7e5f;
            font-weight: bold;
        }
        
        .game-board {
            width: 100%;
            flex: 1;
            min-height: 400px;
            background: rgba(15, 37, 71, 0.9);
            border-radius: 15px;
            border: 3px solid #2a4a7a;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .words-list-container {
            flex: 0 0 auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(42, 74, 122, 0.5);
            border-radius: 10px;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .words-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .word-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .word-item.found {
            background: #4CAF50;
            color: white;
            text-decoration: line-through;
            border-color: #45a049;
        }
        
        .word-item.hint {
            background: #FFD700;
            color: #0c1a2d;
            border-color: #ffcc00;
            animation: hintPulse 1s infinite;
        }
        
        @keyframes hintPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .grid-container {
            flex: 1;
            display: grid;
            gap: 3px;
            background: #2a4a7a;
            padding: 10px;
            border-radius: 10px;
            overflow: auto;
            position: relative;
            touch-action: none;
        }
        
        .grid-cell {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
        }
        
        .grid-cell.selected {
            background: #ff7e5f;
            color: white;
            transform: scale(1.1);
        }
        
        .grid-cell.found {
            background: #4CAF50;
            color: white;
            transform: scale(1.05);
        }
        
        .grid-cell.hint {
            background: #FFD700;
            color: #0c1a2d;
            animation: cellHint 2s infinite;
        }
        
        @keyframes cellHint {
            0%, 100% { background: #FFD700; }
            50% { background: #ffec8b; }
        }
        
        .selection-path {
            position: absolute;
            pointer-events: none;
            z-index: 5;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            gap: 15px;
            flex-shrink: 0;
        }
        
        .control-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            color: #0c1a2d;
        }
        
        .btn-secondary {
            background: #2a4a7a;
            color: white;
        }
        
        .btn-warning {
            background: #ffcc00;
            color: #0c1a2d;
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .tutorial {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
        }
        
        .tutorial h3 {
            font-size: 2.2rem;
            color: #ff7e5f;
            margin-bottom: 20px;
        }
        
        .tutorial p {
            font-size: 1.2rem;
            color: #a3c4f3;
            margin-bottom: 25px;
            line-height: 1.5;
            max-width: 500px;
        }
        
        .tutorial-demo {
            width: 250px;
            height: 250px;
            border-radius: 20px;
            background: rgba(255, 126, 95, 0.1);
            border: 3px solid rgba(255, 126, 95, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 3px;
            width: 100%;
            height: 100%;
        }
        
        .demo-cell {
            background: rgba(42, 74, 122, 0.7);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
        }
        
        .demo-selected {
            background: #ff7e5f;
            color: white;
        }
        
        .demo-found {
            background: #4CAF50;
            color: white;
        }
        
        .demo-hint {
            background: #FFD700;
            color: #0c1a2d;
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
        }
        
        .game-over h2 {
            font-size: 3rem;
            color: #ff7e5f;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 126, 95, 0.7);
        }
        
        .game-over p {
            font-size: 1.5rem;
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .game-over .stats {
            display: flex;
            gap: 30px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            color: #ffcc00;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a3c4f3;
            margin-top: 5px;
        }
        
        .win-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
        }
        
        .win-screen h2 {
            font-size: 3rem;
            color: #4CAF50;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
        }
        
        .bonus-points {
            font-size: 2rem;
            color: #ffcc00;
            margin: 20px 0;
            animation: float 2s infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .crown-animation {
            font-size: 4rem;
            color: #FFD700;
            margin: 20px 0;
            animation: crownFloat 2s infinite ease-in-out;
        }
        
        @keyframes crownFloat {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        .hint-display {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .hint-count {
            color: #FFD700;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .theme-btn {
            background: rgba(42, 74, 122, 0.7);
            color: white;
            border: 2px solid #2a4a7a;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .theme-btn.active {
            background: #ff7e5f;
            color: #0c1a2d;
            border-color: #ff7e5f;
            font-weight: bold;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                gap: 10px;
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .game-board {
                min-height: 350px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .info-value {
                font-size: 1.5rem;
            }
            
            .back-btn {
                top: 10px;
                left: 10px;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .tutorial h3 {
                font-size: 1.8rem;
            }
            
            .tutorial p {
                font-size: 1rem;
            }
            
            .game-over h2 {
                font-size: 2.5rem;
            }
            
            .grid-cell {
                font-size: 1rem;
            }
            
            .words-list-container {
                max-height: 100px;
            }
            
            .word-item {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .game-board {
                min-height: 300px;
            }
            
            .info-value {
                font-size: 1.3rem;
            }
            
            .game-over h2 {
                font-size: 2rem;
            }
            
            .game-over p {
                font-size: 1.2rem;
            }
            
            .grid-cell {
                font-size: 0.9rem;
            }
            
            .words-list-container {
                max-height: 80px;
                padding: 8px;
            }
            
            .word-item {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .hint-display {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
        }
        
        @media (orientation: landscape) and (max-height: 600px) {
            .container {
                height: auto;
                min-height: 100vh;
            }
            
            .game-board {
                height: 60vh;
                flex-direction: row;
            }
            
            .words-list-container {
                flex: 0 0 150px;
                margin-bottom: 0;
                margin-right: 15px;
                max-height: 100%;
            }
            
            .words-list {
                flex-direction: column;
                flex-wrap: nowrap;
            }
            
            .grid-container {
                flex: 1;
            }
            
            .header {
                padding: 5px;
                margin-bottom: 5px;
            }
            
            .game-info {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i> Back to Hub
    </button>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-search"></i> Word Search Xavier</h1>
            <p>Find hidden Xavier-themed words in the grid. Swipe to select letters!</p>
            
            <div class="difficulty-selector">
                <button class="difficulty-btn active" onclick="setDifficulty('easy')">Easy (8Ã—8)</button>
                <button class="difficulty-btn" onclick="setDifficulty('medium')">Medium (10Ã—10)</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')">Hard (12Ã—12)</button>
                <button class="difficulty-btn" onclick="setDifficulty('expert')">Expert (15Ã—15)</button>
            </div>
            
            <div class="theme-selector">
                <button class="theme-btn active" onclick="setTheme('xavier')">Xavier Words</button>
                <button class="theme-btn" onclick="setTheme('games')">Game Words</button>
                <button class="theme-btn" onclick="setTheme('crown')">Crown Words</button>
                <button class="theme-btn" onclick="setTheme('random')">Random</button>
            </div>
        </div>
        
        <div class="game-info">
            <div class="info-box">
                <h3>WORDS</h3>
                <div class="info-value" id="wordsDisplay">0/10</div>
            </div>
            <div class="info-box">
                <h3>TIME</h3>
                <div class="info-value" id="timeDisplay">300</div>
            </div>
            <div class="info-box">
                <h3>SCORE</h3>
                <div class="info-value" id="scoreDisplay">0</div>
            </div>
            <div class="info-box">
                <h3>LEVEL</h3>
                <div class="info-value" id="levelDisplay">1</div>
            </div>
        </div>
        
        <div class="game-board">
            <div class="hint-display" id="hintDisplay">
                <i class="fas fa-crown"></i>
                <span class="hint-count" id="hintCount">3</span>
                <span>Hints</span>
            </div>
            
            <div class="words-list-container">
                <div class="words-list" id="wordsList">
                    <!-- Words will be populated here -->
                </div>
            </div>
            
            <div class="grid-container" id="gridContainer">
                <!-- Grid will be populated here -->
            </div>
            
            <div class="tutorial" id="tutorialScreen">
                <h3>Word Search Xavier Tutorial</h3>
                <div class="tutorial-demo">
                    <div class="demo-grid">
                        <!-- Demo grid cells -->
                        <div class="demo-cell">X</div>
                        <div class="demo-cell">A</div>
                        <div class="demo-cell">V</div>
                        <div class="demo-cell">I</div>
                        <div class="demo-cell">E</div>
                        <div class="demo-cell">R</div>
                        <div class="demo-cell">C</div>
                        <div class="demo-cell">R</div>
                        <div class="demo-cell">O</div>
                        <div class="demo-cell">W</div>
                        <div class="demo-cell">N</div>
                        <div class="demo-cell">G</div>
                        <div class="demo-cell">A</div>
                        <div class="demo-cell">M</div>
                        <div class="demo-cell">E</div>
                        <div class="demo-cell">S</div>
                        <div class="demo-cell">P</div>
                        <div class="demo-cell">L</div>
                        <div class="demo-cell">A</div>
                        <div class="demo-cell">Y</div>
                        <div class="demo-cell">H</div>
                        <div class="demo-cell">U</div>
                        <div class="demo-cell">B</div>
                        <div class="demo-cell">F</div>
                        <div class="demo-cell">U</div>
                    </div>
                </div>
                <p><strong>How to Play:</strong></p>
                <p>1. Swipe to select letters in any direction</p>
                <p>2. Find all words from the list to complete the level</p>
                <p>3. Use crown hints when you're stuck</p>
                <p>4. Complete before time runs out for bonus points!</p>
                <button class="btn-primary control-btn" onclick="startGame()">
                    <i class="fas fa-play"></i> Start Game
                </button>
            </div>
            
            <div class="game-over" id="gameOverScreen">
                <h2>Time's Up!</h2>
                <p>You ran out of time!</p>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="finalWords">0</div>
                        <div class="stat-label">Words Found</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="finalScore">0</div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="finalLevel">1</div>
                        <div class="stat-label">Level</div>
                    </div>
                </div>
                <button class="btn-primary control-btn" onclick="startGame()">
                    <i class="fas fa-redo"></i> Play Again
                </button>
            </div>
            
            <div class="win-screen" id="winScreen">
                <h2>Level Complete! ðŸŽ‰</h2>
                <div class="crown-animation">
                    <i class="fas fa-crown"></i>
                </div>
                <p>All words found!</p>
                <div class="bonus-points" id="bonusPoints">+500 Time Bonus!</div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="nextLevel">2</div>
                        <div class="stat-label">Next Level</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="levelScore">0</div>
                        <div class="stat-label">Level Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="timeLeft">0</div>
                        <div class="stat-label">Time Left</div>
                    </div>
                </div>
                <button class="btn-primary control-btn" onclick="nextLevel()">
                    <i class="fas fa-arrow-right"></i> Next Level
                </button>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn-secondary control-btn" onclick="useHint()">
                <i class="fas fa-crown"></i> Use Hint (<span id="hintBtnCount">3</span>)
            </button>
            <button class="btn-primary control-btn" id="startBtn" onclick="startGame()">
                <i class="fas fa-play"></i> New Game
            </button>
            <button class="btn-warning control-btn" onclick="clearSelection()">
                <i class="fas fa-eraser"></i> Clear
            </button>
        </div>
    </div>

    <script>
        // Game Variables
        let gridSize = 8;
        let grid = [];
        let words = [];
        let foundWords = [];
        let selectedCells = [];
        let selectionPath = [];
        let score = 0;
        let level = 1;
        let timeLeft = 300;
        let hints = 3;
        let gameRunning = false;
        let gameTimer = null;
        let currentTheme = 'xavier';
        let currentDifficulty = 'easy';
        let touchStartCell = null;
        let isSelecting = false;
        
        // Word themes
        const WORD_THEMES = {
            xavier: [
                "XAVIER", "CROWN", "KING", "ROYAL", "GOLD", "THRONE", 
                "PALACE", "JEWEL", "REGAL", "NOBLE", "RULER", "SOVEREIGN",
                "MONARCH", "DIADEM", "SCEPTER", "EMPIRE", "KINGDOM", "REALM",
                "ROYALTY", "MAJESTY"
            ],
            games: [
                "GAME", "PLAY", "FUN", "WIN", "SCORE", "LEVEL", "PUZZLE",
                "ARCADE", "ACTION", "STRATEGY", "ADVENTURE", "CHALLENGE",
                "CONTROL", "MOBILE", "TOUCH", "SWIPE", "TAP", "MATCH",
                "SOLVE", "BRAIN"
            ],
            crown: [
                "CROWN", "TIARA", "CORONET", "DIADEM", "REGALIA", "JEWELS",
                "GEMS", "PRECIOUS", "GOLDEN", "SILVER", "PLATINUM", "DIAMOND",
                "RUBY", "EMERALD", "SAPPHIRE", "PEARL", "OPAL", "AMETHYST",
                "TOPAZ", "BERYL"
            ],
            random: [
                "PUZZLE", "SEARCH", "HIDDEN", "WORDS", "LETTERS", "GRID",
                "FIND", "LOCATE", "DISCOVER", "UNCOVER", "REVEAL", "DETECT",
                "SPOT", "SEEK", "HUNT", "TRACK", "TRACE", "FOLLOW",
                "EXPLORE", "INVESTIGATE"
            ]
        };
        
        // Difficulty settings
        const DIFFICULTY_SETTINGS = {
            easy: { size: 8, words: 8, time: 300 },
            medium: { size: 10, words: 12, time: 420 },
            hard: { size: 12, words: 15, time: 540 },
            expert: { size: 15, words: 20, time: 660 }
        };
        
        // Direction vectors for word placement
        const DIRECTIONS = [
            { x: 1, y: 0 },   // Right
            { x: 0, y: 1 },   // Down
            { x: 1, y: 1 },   // Down-Right
            { x: 1, y: -1 },  // Up-Right
            { x: -1, y: 0 },  // Left
            { x: 0, y: -1 },  // Up
            { x: -1, y: -1 }, // Up-Left
            { x: -1, y: 1 }   // Down-Left
        ];
        
        // Initialize Game
        function initGame() {
            setupGrid();
            updateDisplay();
            
            // Show tutorial for first play
            const hasPlayed = localStorage.getItem('wordsearch_played');
            if (!hasPlayed) {
                document.getElementById('tutorialScreen').style.display = 'flex';
                localStorage.setItem('wordsearch_played', 'true');
            }
        }
        
        // Setup grid
        function setupGrid() {
            const container = document.getElementById('gridContainer');
            container.innerHTML = '';
            
            // Create grid cells
            container.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            container.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.id = `cell-${row}-${col}`;
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // Add touch/click events
                    cell.addEventListener('mousedown', startSelection);
                    cell.addEventListener('mouseenter', continueSelection);
                    cell.addEventListener('mouseup', endSelection);
                    
                    cell.addEventListener('touchstart', handleTouchStart);
                    cell.addEventListener('touchmove', handleTouchMove);
                    cell.addEventListener('touchend', handleTouchEnd);
                    
                    container.appendChild(cell);
                }
            }
        }
        
        // Generate new puzzle
        function generatePuzzle() {
            // Reset grid
            grid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
            words = [];
            foundWords = [];
            selectedCells = [];
            selectionPath = [];
            
            // Get word list for current theme
            let wordList = [...WORD_THEMES[currentTheme]];
            
            // Shuffle and select words
            shuffleArray(wordList);
            const numWords = DIFFICULTY_SETTINGS[currentDifficulty].words;
            const selectedWords = wordList.slice(0, numWords);
            
            // Place words in grid
            placeWords(selectedWords);
            
            // Fill empty cells with random letters
            fillEmptyCells();
            
            // Update grid display
            updateGridDisplay();
            
            // Update words list
            updateWordsList();
        }
        
        // Place words in grid
        function placeWords(wordList) {
            words = [];
            
            for (let word of wordList) {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 100) {
                    attempts++;
                    
                    // Choose random starting position
                    const startRow = Math.floor(Math.random() * gridSize);
                    const startCol = Math.floor(Math.random() * gridSize);
                    
                    // Choose random direction
                    const direction = DIRECTIONS[Math.floor(Math.random() * DIRECTIONS.length)];
                    
                    // Check if word fits
                    if (canPlaceWord(word, startRow, startCol, direction)) {
                        // Place word
                        placeWord(word, startRow, startCol, direction);
                        words.push({
                            word: word,
                            cells: getWordCells(word, startRow, startCol, direction),
                            found: false
                        });
                        placed = true;
                    }
                }
                
                if (!placed) {
                    console.log(`Could not place word: ${word}`);
                }
            }
        }
        
        // Check if word can be placed
        function canPlaceWord(word, row, col, direction) {
            for (let i = 0; i < word.length; i++) {
                const newRow = row + direction.y * i;
                const newCol = col + direction.x * i;
                
                // Check bounds
                if (newRow < 0 || newRow >= gridSize || newCol < 0 || newCol >= gridSize) {
                    return false;
                }
                
                // Check if cell is empty or has same letter
                if (grid[newRow][newCol] !== '' && grid[newRow][newCol] !== word[i]) {
                    return false;
                }
            }
            return true;
        }
        
        // Place word in grid
        function placeWord(word, row, col, direction) {
            for (let i = 0; i < word.length; i++) {
                const newRow = row + direction.y * i;
                const newCol = col + direction.x * i;
                grid[newRow][newCol] = word[i];
            }
        }
        
        // Get cells occupied by a word
        function getWordCells(word, row, col, direction) {
            const cells = [];
            for (let i = 0; i < word.length; i++) {
                cells.push({
                    row: row + direction.y * i,
                    col: col + direction.x * i
                });
            }
            return cells;
        }
        
        // Fill empty cells with random letters
        function fillEmptyCells() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    if (grid[row][col] === '') {
                        grid[row][col] = letters[Math.floor(Math.random() * letters.length)];
                    }
                }
            }
        }
        
        // Update grid display
        function updateGridDisplay() {
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cell = document.getElementById(`cell-${row}-${col}`);
                    if (cell) {
                        cell.textContent = grid[row][col];
                        
                        // Reset cell state
                        cell.classList.remove('selected', 'found', 'hint');
                    }
                }
            }
        }
        
        // Update words list
        function updateWordsList() {
            const wordsList = document.getElementById('wordsList');
            wordsList.innerHTML = '';
            
            words.forEach((wordObj, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                if (wordObj.found) {
                    wordItem.classList.add('found');
                }
                wordItem.textContent = wordObj.word;
                wordItem.dataset.index = index;
                
                // Add click event for hint
                wordItem.addEventListener('click', () => {
                    if (!wordObj.found) {
                        highlightWordHint(index);
                    }
                });
                
                wordsList.appendChild(wordItem);
            });
        }
        
        // Start selection
        function startSelection(e) {
            if (!gameRunning) return;
            
            e.preventDefault();
            const cell = e.target.closest('.grid-cell');
            if (!cell) return;
            
            isSelecting = true;
            touchStartCell = cell;
            
            // Clear previous selection
            clearSelection();
            
            // Start new selection
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            addToSelection(row, col);
            
            return false;
        }
        
        // Continue selection
        function continueSelection(e) {
            if (!isSelecting || !gameRunning) return;
            
            const cell = e.target.closest('.grid-cell');
            if (!cell || !touchStartCell) return;
            
            const startRow = parseInt(touchStartCell.dataset.row);
            const startCol = parseInt(touchStartCell.dataset.col);
            const endRow = parseInt(cell.dataset.row);
            const endCol = parseInt(cell.dataset.col);
            
            // Calculate direction
            const rowDiff = endRow - startRow;
            const colDiff = endCol - startCol;
            
            // Only allow straight lines or 45-degree diagonals
            if (rowDiff === 0 || colDiff === 0 || Math.abs(rowDiff) === Math.abs(colDiff)) {
                clearSelection();
                
                // Determine step direction
                const rowStep = rowDiff === 0 ? 0 : rowDiff / Math.abs(rowDiff);
                const colStep = colDiff === 0 ? 0 : colDiff / Math.abs(colDiff);
                
                // Add all cells in line
                let currentRow = startRow;
                let currentCol = startCol;
                const maxLength = Math.max(Math.abs(rowDiff), Math.abs(colDiff)) + 1;
                
                for (let i = 0; i < maxLength; i++) {
                    addToSelection(currentRow, currentCol);
                    currentRow += rowStep;
                    currentCol += colStep;
                }
            }
        }
        
        // End selection
        function endSelection(e) {
            if (!isSelecting || !gameRunning) return;
            
            isSelecting = false;
            
            // Check if selected letters form a word
            checkSelectedWord();
            
            // Clear selection after delay
            setTimeout(clearSelection, 1000);
        }
        
        // Touch handlers
        function handleTouchStart(e) {
            if (!gameRunning) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            const cell = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (cell && cell.classList.contains('grid-cell')) {
                startSelection({ target: cell, preventDefault: () => {} });
            }
        }
        
        function handleTouchMove(e) {
            if (!isSelecting || !gameRunning) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            const cell = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (cell && cell.classList.contains('grid-cell')) {
                continueSelection({ target: cell });
            }
        }
        
        function handleTouchEnd(e) {
            if (!isSelecting || !gameRunning) return;
            
            e.preventDefault();
            endSelection();
        }
        
        // Add cell to selection
        function addToSelection(row, col) {
            // Check bounds
            if (row < 0 || row >= gridSize || col < 0 || col >= gridSize) return;
            
            // Check if already selected
            if (selectedCells.some(cell => cell.row === row && cell.col === col)) return;
            
            selectedCells.push({ row, col });
            
            // Update cell appearance
            const cell = document.getElementById(`cell-${row}-${col}`);
            if (cell) {
                cell.classList.add('selected');
            }
            
            // Update selection path for visual line
            updateSelectionPath();
        }
        
        // Update selection path visualization
        function updateSelectionPath() {
            // Remove old path
            const oldPath = document.querySelector('.selection-path');
            if (oldPath) oldPath.remove();
            
            if (selectedCells.length < 2) return;
            
            // Create new path
            const container = document.getElementById('gridContainer');
            const path = document.createElement('div');
            path.className = 'selection-path';
            
            // Get container position
            const containerRect = container.getBoundingClientRect();
            
            // Create SVG path
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.style.position = "absolute";
            svg.style.top = "0";
            svg.style.left = "0";
            
            const pathElement = document.createElementNS(svgNS, "path");
            pathElement.setAttribute("stroke", "#ff7e5f");
            pathElement.setAttribute("stroke-width", "4");
            pathElement.setAttribute("fill", "none");
            pathElement.setAttribute("stroke-linecap", "round");
            
            // Calculate path data
            let pathData = "";
            selectedCells.forEach((cell, index) => {
                const cellElement = document.getElementById(`cell-${cell.row}-${cell.col}`);
                if (cellElement) {
                    const cellRect = cellElement.getBoundingClientRect();
                    const x = cellRect.left - containerRect.left + cellRect.width / 2;
                    const y = cellRect.top - containerRect.top + cellRect.height / 2;
                    
                    if (index === 0) {
                        pathData = `M ${x} ${y}`;
                    } else {
                        pathData += ` L ${x} ${y}`;
                    }
                }
            });
            
            pathElement.setAttribute("d", pathData);
            svg.appendChild(pathElement);
            path.appendChild(svg);
            container.appendChild(path);
        }
        
        // Clear selection
        function clearSelection() {
            selectedCells.forEach(cell => {
                const cellElement = document.getElementById(`cell-${cell.row}-${cell.col}`);
                if (cellElement && !cellElement.classList.contains('found')) {
                    cellElement.classList.remove('selected');
                }
            });
            
            selectedCells = [];
            
            // Remove selection path
            const path = document.querySelector('.selection-path');
            if (path) path.remove();
        }
        
        // Check if selected letters form a word
        function checkSelectedWord() {
            if (selectedCells.length < 3) return;
            
            // Get selected letters
            const selectedWord = selectedCells.map(cell => 
                grid[cell.row][cell.col]
            ).join('');
            
            // Check forward
            words.forEach((wordObj, index) => {
                if (!wordObj.found && selectedWord === wordObj.word) {
                    foundWord(index);
                    return;
                }
            });
            
            // Check reverse
            const reversedWord = selectedWord.split('').reverse().join('');
            words.forEach((wordObj, index) => {
                if (!wordObj.found && reversedWord === wordObj.word) {
                    foundWord(index);
                    return;
                }
            });
        }
        
        // Handle found word
        function foundWord(wordIndex) {
            const wordObj = words[wordIndex];
            wordObj.found = true;
            foundWords.push(wordObj.word);
            
            // Mark cells as found
            wordObj.cells.forEach(cell => {
                const cellElement = document.getElementById(`cell-${cell.row}-${cell.col}`);
                if (cellElement) {
                    cellElement.classList.remove('selected');
                    cellElement.classList.add('found');
                }
            });
            
            // Update score
            const wordScore = wordObj.word.length * 100 * level;
            score += wordScore;
            
            // Update display
            updateDisplay();
            updateWordsList();
            
            // Check for level completion
            if (foundWords.length === words.length) {
                completeLevel();
            }
            
            // Play sound effect (simulated)
            playSound('found');
        }
        
        // Use hint
        function useHint() {
            if (!gameRunning || hints <= 0) return;
            
            hints--;
            updateHintDisplay();
            
            // Find first unfound word
            const unfoundWordIndex = words.findIndex(word => !word.found);
            if (unfoundWordIndex !== -1) {
                highlightWordHint(unfoundWordIndex);
            }
        }
        
        // Highlight word hint
        function highlightWordHint(wordIndex) {
            const wordObj = words[wordIndex];
            
            // Highlight word in list
            const wordItems = document.querySelectorAll('.word-item');
            if (wordItems[wordIndex]) {
                wordItems[wordIndex].classList.add('hint');
                
                // Remove highlight after 3 seconds
                setTimeout(() => {
                    wordItems[wordIndex].classList.remove('hint');
                }, 3000);
            }
            
            // Highlight first letter in grid
            const firstCell = wordObj.cells[0];
            const cellElement = document.getElementById(`cell-${firstCell.row}-${firstCell.col}`);
            if (cellElement) {
                cellElement.classList.add('hint');
                
                // Remove highlight after 3 seconds
                setTimeout(() => {
                    cellElement.classList.remove('hint');
                }, 3000);
            }
            
            // Play sound effect (simulated)
            playSound('hint');
        }
        
        // Set difficulty
        function setDifficulty(difficulty) {
            currentDifficulty = difficulty;
            gridSize = DIFFICULTY_SETTINGS[difficulty].size;
            
            // Update active button
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Restart game if running
            if (gameRunning) {
                if (confirm('Changing difficulty will restart the game. Continue?')) {
                    startGame();
                }
            }
        }
        
        // Set theme
        function setTheme(theme) {
            currentTheme = theme;
            
            // Update active button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Regenerate puzzle if game is running
            if (gameRunning) {
                generatePuzzle();
                updateGridDisplay();
                updateWordsList();
                clearSelection();
            }
        }
        
        // Start game
        function startGame() {
            document.getElementById('tutorialScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
            
            // Reset game state
            score = 0;
            level = 1;
            hints = 3;
            foundWords = [];
            
            // Set time based on difficulty
            timeLeft = DIFFICULTY_SETTINGS[currentDifficulty].time;
            
            // Setup grid
            setupGrid();
            
            // Generate puzzle
            generatePuzzle();
            
            updateDisplay();
            updateHintDisplay();
            document.getElementById('startBtn').innerHTML = '<i class="fas fa-redo"></i> Restart';
            
            gameRunning = true;
            startTimer();
            
            // Record play
            const currentPlays = parseInt(localStorage.getItem('wordsearch_plays') || 0);
            localStorage.setItem('wordsearch_plays', currentPlays + 1);
        }
        
        // Start timer
        function startTimer() {
            clearInterval(gameTimer);
            
            gameTimer = setInterval(() => {
                if (!gameRunning) return;
                
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    gameOver();
                }
                
                // Flash time when critical
                if (timeLeft <= 30) {
                    document.getElementById('timeDisplay').classList.add('time-warning');
                } else {
                    document.getElementById('timeDisplay').classList.remove('time-warning');
                }
            }, 1000);
        }
        
        // Complete level
        function completeLevel() {
            gameRunning = false;
            clearInterval(gameTimer);
            
            // Calculate bonus
            const timeBonus = Math.floor(timeLeft / 10) * 50;
            const levelBonus = level * 500;
            const totalBonus = timeBonus + levelBonus;
            score += totalBonus;
            
            // Show win screen
            document.getElementById('nextLevel').textContent = level + 1;
            document.getElementById('levelScore').textContent = totalBonus;
            document.getElementById('timeLeft').textContent = timeLeft;
            document.getElementById('bonusPoints').textContent = `+${totalBonus} Bonus Points!`;
            document.getElementById('winScreen').style.display = 'flex';
            
            // Play sound effect (simulated)
            playSound('win');
        }
        
        // Next level
        function nextLevel() {
            level++;
            hints = Math.min(hints + 1, 5); // Add hint for next level, max 5
            foundWords = [];
            
            // Increase difficulty slightly
            const difficultySettings = DIFFICULTY_SETTINGS[currentDifficulty];
            timeLeft = difficultySettings.time + (level - 1) * 30; // Add 30 seconds per level
            
            // Generate new puzzle
            generatePuzzle();
            
            updateDisplay();
            updateHintDisplay();
            document.getElementById('winScreen').style.display = 'none';
            gameRunning = true;
            startTimer();
        }
        
        // Game over
        function gameOver() {
            gameRunning = false;
            clearInterval(gameTimer);
            
            // Update final stats
            document.getElementById('finalWords').textContent = foundWords.length;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            
            // Show game over screen
            document.getElementById('gameOverScreen').style.display = 'flex';
            
            // Save high score
            saveHighScore();
            
            // Play sound effect (simulated)
            playSound('gameover');
        }
        
        // Save high score
        function saveHighScore() {
            const currentHighScore = localStorage.getItem('wordsearch_high_score') || 0;
            if (score > currentHighScore) {
                localStorage.setItem('wordsearch_high_score', score);
                localStorage.setItem('wordsearch_high_level', level);
            }
            
            // Update total plays and score
            const totalScore = parseInt(localStorage.getItem('wordsearch_total_score') || 0) + score;
            localStorage.setItem('wordsearch_total_score', totalScore);
        }
        
        // Update display
        function updateDisplay() {
            document.getElementById('wordsDisplay').textContent = `${foundWords.length}/${words.length}`;
            document.getElementById('timeDisplay').textContent = timeLeft;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('levelDisplay').textContent = level;
        }
        
        // Update hint display
        function updateHintDisplay() {
            document.getElementById('hintCount').textContent = hints;
            document.getElementById('hintBtnCount').textContent = hints;
        }
        
        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Simulated sound effects
        function playSound(type) {
            // In a real implementation, you would play actual audio files
            console.log(`Playing ${type} sound`);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            if (!gameRunning) return;
            
            switch(e.key) {
                case 'h':
                case 'H':
                    e.preventDefault();
                    useHint();
                    break;
                case 'c':
                case 'C':
                    e.preventDefault();
                    clearSelection();
                    break;
                case ' ':
                    e.preventDefault();
                    startGame();
                    break;
                case 'r':
                case 'R':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        startGame();
                    }
                    break;
            }
        });
        
        // Prevent default touch behavior
        document.addEventListener('touchmove', function(e) {
            if (isSelecting) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Initialize game on load
        window.addEventListener('load', initGame);
    </script>
</body>
</html>